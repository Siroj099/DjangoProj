{% for ticket in tickets %}
    {% include 'single_ticket.html' %}
{% empty %}
    <div class="text-center text-gray-500">
        No tickets found.
    </div>
{% endfor %}

<script>
    // Comment functions
    function toggleComments(ticketId) {
        const commentsSection = document.getElementById(`comments-${ticketId}`);
        const isHidden = commentsSection.classList.contains('hidden');
        commentsSection.classList.toggle('hidden');
        
        // Close all nested replies when hiding comments
        if (!isHidden) {
            const nestedReplies = commentsSection.querySelectorAll('[id^="nested-replies-"]');
            nestedReplies.forEach(reply => reply.classList.add('hidden'));
        }
    }
    function toggleAddComment(ticketId) {
        const addCommentSection = document.getElementById(`addCommentLabel-${ticketId}`);
        const addCommentButton = document.getElementById(`addCommentButton-${ticketId}`);
        
        addCommentSection.classList.toggle('hidden');
        addCommentButton.classList.add('hidden');
    }
    function hideAddComment(ticketId) {
        const addCommentSection = document.getElementById(`addCommentLabel-${ticketId}`);
        const addCommentButton = document.getElementById(`addCommentButton-${ticketId}`);

        document.getElementById(`commentAuthor-${ticketId}`).value = '';
        document.getElementById(`commentDescription-${ticketId}`).value = '';
        
        addCommentSection.classList.toggle('hidden');
        addCommentButton.classList.remove('hidden');
    }
    // Reply functions
    function toggleReplies(commentId) {
        const repliesSection = document.getElementById(`nested-replies-${commentId}`);
        repliesSection.classList.toggle('hidden');
    }
    function toggleAddReply(commentId) {
        const addReplySection = document.getElementById(`addReplyLabel-${commentId}`);
        const addReplyButton = document.getElementById(`addReplyButton-${commentId}`);
        
        addReplySection.classList.toggle('hidden');
        addReplyButton.classList.add('hidden');
    }
    function hideAddReply(commentId) {
        const addReplySection = document.getElementById(`addReplyLabel-${commentId}`);
        const addReplyButton = document.getElementById(`addReplyButton-${commentId}`);

        document.getElementById(`replyAuthor-${commentId}`).value = '';
        document.getElementById(`replyDescription-${commentId}`).value = '';
        
        addReplySection.classList.toggle('hidden');
        addReplyButton.classList.remove('hidden');
    }
</script>